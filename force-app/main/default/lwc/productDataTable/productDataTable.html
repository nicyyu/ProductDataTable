<template>
  <lightning-card if:true={viewRowDataView}>
    <div class="slds-var-p-around_small">
      <div>
        <span class="slds-form-element__label slds-text-title_bold slds-align_absolute-center">
          Product Search
        </span >
      </div>
    </div>
    <div>
      <span class="slds-form-element__label slds-text-title_bold slds-align_absolute-center">
        Display Records: {data.length}
      </span>
      <span class="slds-form-element__label slds-text-title_bold slds-align_absolute-center">
        Customer Price Book: {accountPB}
      </span>
      <span class="slds-form-element__label slds-text-title_bold slds-align_absolute-center">
        Customer Currency: {accountCurrency}
      </span>
    </div>
    <!--Show selected rows-->
    <div class="slds-box slds-p-around_small slds-m-top_medium slds-m-horizontal_none" onkeyup={handleKeyUp}>
      <div class="slds-text-title_bold slds-align_absolute-center">
        <p>Search all product fields based on single input.</p>
      </div>
      <lightning-input
          name="enter-search"
          label="Search when user hits the 'enter' key"
          type="search"
          value={queryTerm}
          data-id="queryTerm-field"
      ></lightning-input>
      <p if:true={queryTerm}>
        Searched for {queryTerm}!
      </p>
    </div>
    <div class="slds-box slds-p-around_small slds-m-top_medium slds-m-bottom_medium slds-m-horizontal_none">
      <div class="slds-text-title_bold slds-align_absolute-center">
        <p>Search product based on selected fields.</p>
      </div>
      <!--Search row 1-->
      <div>
        <lightning-layout horizontal-align="space">
          <lightning-layout-item padding="around-small" size="4">
            <div class="header-column">
                <p class="field-title" title="Fields">Fields</p>
                <lightning-combobox
                  name="fields"
                  value={SR1Field}
                  placeholder="Select Field"
                  options={options}
                  variant="label-hidden"
                  onchange={handleChange}
                  data-id="SR1-field"></lightning-combobox>
            </div>
          </lightning-layout-item>
          <lightning-layout-item padding="around-small" size="4">
            <div class="header-column">
                <p class="field-title" title="Operator">Operator</p>
                <lightning-combobox
                  name="operator"
                  value={SR1Operator}
                  placeholder="Select Operator"
                  options={operators}
                  variant="label-hidden"
                  onchange={handleChange}
                  data-id="SR1-operator"></lightning-combobox>
            </div>
          </lightning-layout-item>
          <lightning-layout-item padding="around-small" size="4">
            <div class="header-column" onkeyup={handleKeyUpMultiSearch}>
                <p class="field-title" title="Inputs">Inputs</p>
                <lightning-input 
                  type="text"
                  class="fields"
                  variant="label-hidden"
                  label="SR1Input"
                  name="SR1Input"
                  value={SR1Input}
                  data-id="SR1-input"
                  onchange={handleChange}></lightning-input>
            </div>
          </lightning-layout-item>
        </lightning-layout>
      </div>
      <div>
        AND
      </div>
      <!--Search row 2-->
      <div>
        <lightning-layout horizontal-align="space">
          <lightning-layout-item padding="around-small" size="4">
            <div class="header-column">
                <p class="field-title" title="Fields">Fields</p>
                <lightning-combobox
                  name="fields"
                  value={SR2Field}
                  placeholder="Select Field"
                  options={options}
                  variant="label-hidden"
                  onchange={handleChange}
                  data-id="SR2-field"></lightning-combobox>
            </div>
          </lightning-layout-item>
          <lightning-layout-item padding="around-small" size="4">
            <div class="header-column">
                <p class="field-title" title="Operator">Operator</p>
                <lightning-combobox
                  name="operator"
                  value={SR2Operator}
                  placeholder="Select Operator"
                  options={operators}
                  variant="label-hidden"
                  onchange={handleChange}
                  data-id="SR2-operator"></lightning-combobox>
            </div>
          </lightning-layout-item>
          <lightning-layout-item padding="around-small" size="4">
            <div class="header-column" onkeyup={handleKeyUpMultiSearch}>
                <p class="field-title" title="Inputs">Inputs</p>
                <lightning-input 
                  type="text"
                  class="fields"
                  variant="label-hidden"
                  label="SR2Input"
                  name="SR2Input"
                  value={SR2Input}
                  data-id="SR2-input"
                  onchange={handleChange}></lightning-input>
            </div>
          </lightning-layout-item>
        </lightning-layout>
      </div>
      <div>
        AND
      </div>
      <!--Search row 3-->
      <div>
        <lightning-layout horizontal-align="space">
          <lightning-layout-item padding="around-small" size="4">
            <div class="header-column">
                <p class="field-title" title="Fields">Fields</p>
                <lightning-combobox
                  name="fields"
                  value={SR3Field}
                  placeholder="Select Field"
                  options={options}
                  variant="label-hidden"
                  onchange={handleChange}
                  data-id="SR3-field"></lightning-combobox>
            </div>
          </lightning-layout-item>
          <lightning-layout-item padding="around-small" size="4">
            <div class="header-column">
                <p class="field-title" title="Operator">Operator</p>
                <lightning-combobox
                  name="operator"
                  value={SR3Operator}
                  placeholder="Select Operator"
                  options={operators}
                  variant="label-hidden"
                  onchange={handleChange}
                  data-id="SR3-operator"></lightning-combobox>
            </div>
          </lightning-layout-item>
          <lightning-layout-item padding="around-small" size="4">
            <div class="header-column" onkeyup={handleKeyUpMultiSearch}>
                <p class="field-title" title="Inputs">Inputs</p>
                <lightning-input 
                  type="text"
                  class="fields"
                  variant="label-hidden"
                  label="SR3Input"
                  name="SR3Input"
                  value={SR3Input}
                  data-id="SR3-input"
                  onchange={handleChange}></lightning-input>
            </div>
          </lightning-layout-item>
        </lightning-layout>
      </div>
    </div>
    <div class="slds-p-around_small slds-m-bottom_medium slds-m-horizontal_none">
      <lightning-button onclick={showSelected} label="Show Selected Rows"></lightning-button>
      <lightning-button onclick={refreshCmp} label="Reset"></lightning-button>
    </div>
    <!--product display table-->
    <div style="height: 350px;" if:true={boolVisible}>
      <lightning-datatable 
        key-field="Id" 
        data={data} 
        columns={columns} 
        enable-infinite-loading
        onloadmore={handleLoadMore} 
        selected-rows={preselectedRows}
        onrowselection={selectedRowHandler}
        load-more-offset="20">
      </lightning-datatable>
    </div>
    {loadMoreStatus}
    <!--show select products table-->
    <div style="height: 350px;" if:false={boolVisible}>
      <lightning-datatable 
        key-field="Id" 
        data={selectedData} 
        columns={columns}
        column-widths-mode="auto"
        selected-rows={preselectedRows}
        onrowselection={selectedRowHandler}>
      </lightning-datatable>
    </div>
    <div class="slds-p-around_small slds-m-top_small slds-m-horizontal_none">
      <lightning-button onclick={toEditRowData} label="Next"></lightning-button>
    </div>
  </lightning-card>
  <!--edit selected products-->
  <lightning-card if:true={editRowDataView}>
    <div class="slds-m-around_medium">
      <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_resizable-cols" aria-labelledby="element-with-table-label other-element-with-table-label">
          <thead>
              <tr class="slds-line-height_reset">
                  <th class="" scope="col">
                      <div class="slds-truncate" title="Product Name">Product Name</div>
                  </th>
                  <th class="" scope="col">
                    <div class="slds-truncate" title="Product Quantity">Product Quantity</div>
                  </th>
                  <th class="" scope="col">
                      <div class="slds-truncate" title="Sales Price">Sales Price</div>
                  </th>
                  <th class="" scope="col">
                    <div class="slds-truncate" title="Discount %">Discount %</div>
                  </th>
                  <th class="" scope="col">
                    <div class="slds-truncate" title="Line Item Comment">Line Item Comment</div>
                  </th>
              </tr>
          </thead>
          <tbody>
            <template for:each={PBEListFinal} for:item="obj">
                <tr class="inputRows" key={obj.Id}>
                    <th data-label="Product Name" scope="row">
                      <lightning-formatted-url value={obj.linkName} label={obj.Product2Name} target="_blank"></lightning-formatted-url>
                    </th>
                    <th data-label="Product Quantity" scope="row">
                      <lightning-input type="number" class="fields" variant="label-hidden" label="Quantity" name="Product2Id" value={obj.Quantity} step="0" data-id={obj.Product2Id} onchange={updateValues}></lightning-input>
                    </th>
                    <th data-label="Sales Price" scope="row">
                      <lightning-input type="number" class="fields" variant="label-hidden" label="UnitPrice" name="Product2Id" value={obj.UnitPrice} formatter="currency" step="0.01" data-id={obj.Product2Id} onchange={updateValues}></lightning-input>
                    </th>
                    <th data-label="Discount" scope="row">
                      <lightning-input type="number" class="fields" variant="label-hidden" label="Discount" name="Product2Id" value={obj.Discount} min="0" max="100" step="0.01" data-id={obj.Product2Id} onchange={updateValues}></lightning-input>
                    </th>
                    <th data-label="Line Item Comment" scope="row">
                        <lightning-input type="text" class="fields" variant="label-hidden" label="Comment" name="Product2Id" value={obj.Comment} data-id={obj.Product2Id} onchange={updateValues}></lightning-input>
                    </th>
                </tr>
            </template>
        </tbody>
      </table>
    </div>
    <div if:true={isLoaded} class="slds-is-relative">
      <lightning-spinner alternative-text="Loading...">
      </lightning-spinner>
    </div>
    <div class="slds-p-around_small slds-m-top_small slds-m-horizontal_none">
      <lightning-button onclick={toViewRowData} label="Back"></lightning-button>
      <lightning-button onclick={saveQuoteLines} label="Save"></lightning-button>
    </div>
  </lightning-card>
</template>