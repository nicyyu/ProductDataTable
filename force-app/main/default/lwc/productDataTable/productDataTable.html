<template>
  <lightning-card if:true={viewRowDataView}>
    <div class="slds-var-p-around_small">
      <div>
        <span class="slds-form-element__label slds-text-title_bold slds-align_absolute-center">
          Product Search
        </span >
        <span class="slds-form-element__label slds-text-title_bold slds-align_absolute-center">
          Quote Id: {recordId}
        </span>
      </div>
    </div>
    <div>
      <span class="slds-form-element__label slds-text-title_bold">
        Total Records: {totalNumberOfRows}
      </span>
    </div>
    <div>
      <span class="slds-form-element__label slds-text-title_bold">
        Displayed Records: {data.length}
      </span>
    </div>
    <!--show select rows-->
    <div onkeyup={handleKeyUp}>
      <lightning-input
          name="enter-search"
          label="Search when user hits the 'enter' key"
          type="search"
      ></lightning-input>
    </div>
    <p if:true={queryTerm}>
      Searched for {queryTerm}!
    </p>
    <div>
      <lightning-button onclick={showSelected} label="Show Selected Rows"></lightning-button>
    </div>
    <!--product display table-->
    <div style="height: 350px;" if:true={boolVisible}>
      <lightning-datatable 
        key-field="Id" 
        data={data} 
        columns={columns} 
        enable-infinite-loading 
        onloadmore={handleLoadMore} 
        selected-rows={preselectedRows}
        onrowselection={selectedRowHandler}
        load-more-offset="20">
      </lightning-datatable>
    </div>
    {loadMoreStatus}
    <!--show select products table-->
    <div style="height: 350px;" if:false={boolVisible}>
      <lightning-datatable 
        key-field="Id" 
        data={selectedData} 
        columns={columns}  
        selected-rows={preselectedRows}
        onrowselection={selectedRowHandler}>
      </lightning-datatable>
    </div>
    <lightning-button onclick={toEditRowData} label="Next"></lightning-button>
  </lightning-card>
  <!--edit selected products-->
  <lightning-card if:true={editRowDataView}>
    <div class="slds-m-around_medium">
      <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_resizable-cols" aria-labelledby="element-with-table-label other-element-with-table-label">
          <thead>
              <tr class="slds-line-height_reset">
                  <th class="" scope="col">
                      <div class="slds-truncate" title="Product Name">Product Name</div>
                  </th>
                  <th class="" scope="col">
                    <div class="slds-truncate" title="Product Quantity">Product Quantity</div>
                  </th>
                  <th class="" scope="col">
                      <div class="slds-truncate" title="Sales Price">Sales Price</div>
                  </th>
                  <th class="" scope="col">
                    <div class="slds-truncate" title="Discount">Discount</div>
                  </th>
                  <th class="" scope="col">
                    <div class="slds-truncate" title="Line Item Comment">Line Item Comment</div>
                  </th>
              </tr>
          </thead>
          <tbody>
            <template for:each={PBEListFinal} for:item="obj">
                <tr class="inputRows" key={obj.Id}>
                    <th data-label="Product Name" scope="row">
                      <lightning-formatted-url value={obj.linkName} label={obj.Product2Name} target="_blank"></lightning-formatted-url>
                    </th>
                    <th data-label="Product Quantity" scope="row">
                      <lightning-input type="number" class="fields" variant="label-hidden" label="Quantity" name="Product2Id" value={obj.Quantity} step="0" data-id={obj.Product2Id} onchange={updateValues}></lightning-input>
                    </th>
                    <th data-label="Sales Price" scope="row">
                      <lightning-input type="number" class="fields" variant="label-hidden" label="UnitPrice" name="Product2Id" value={obj.UnitPrice} formatter="currency" step="0.01" data-id={obj.Product2Id} onchange={updateValues}></lightning-input>
                    </th>
                    <th data-label="Discount" scope="row">
                      <lightning-input type="number" class="fields" variant="label-hidden" label="Discount" name="Product2Id" value={obj.Discount} min="0" max="100" step="0.01" data-id={obj.Product2Id} onchange={updateValues}></lightning-input>
                    </th>
                    <th data-label="Line Item Comment" scope="row">
                        <lightning-input type="text" class="fields" variant="label-hidden" label="Comment" name="Product2Id" value={obj.Comment} data-id={obj.Product2Id} onchange={updateValues}></lightning-input>
                    </th>
                </tr>
            </template>
        </tbody>
      </table>
    </div>
    <div>
      <lightning-button onclick={toViewRowData} label="Back"></lightning-button>
      <lightning-button onclick={saveQuoteLines} label="Save"></lightning-button>
    </div>
  </lightning-card>
</template>